<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Cuestionario de Autonomía</title>
  <link rel="stylesheet" href="estilo.css">
</head>
<body>
  <h1>Cuestionario de Autonomía</h1>

  <div class="instrucciones">
    <p><strong>INSTRUCCIONES:</strong> Lee cada afirmación y escribe tu respuesta libremente.</p>
  </div>

  <form id="cuestionario">
    <h2>Datos Generales</h2>
    <label>Edad (años):</label>
    <input type="number" name="edad" required min="1">

    <label>Sexo (opcional):</label>
    <input type="text" name="sexo">

    <label>Escolaridad:</label>
    <input type="text" name="escolaridad" required>

    <label>Ocupación:</label>
    <input type="text" name="ocupacion" required>

    <label>Estatura (cm):</label>
    <input type="number" name="estatura" required min="30" max="250">

    <label>Peso (kg):</label>
    <input type="number" name="peso" required min="10" max="300">

    <label>Horas de sueño promedio:</label>
    <input type="number" name="sueno" required min="0" max="24">

    <label>Días/semana con actividad física (≥30 min):</label>
    <input type="number" name="actividad" required min="0" max="7">

    <h2>Ítems</h2>
    <div id="items"></div>

    <button type="submit">Enviar</button>
  </form>

  <script>
    const items = [
      "Cumplo mis compromisos a tiempo sin que me recuerden",
      "Tomo decisiones por mí mismo(a) y asumo sus consecuencias",
      "Necesito que alguien me diga exactamente qué hacer. (invertida)",
      "Cuando me enojo o me frustro, recupero la calma con facilidad",
      "Mis emociones cambian muy rápido y me cuesta controlarlas. (invertida)",
      "Hago planes para metas a mediano o largo plazo (semanas/meses)",
      "Me cuesta pensar en las consecuencias futuras de mis actos. (invertida)",
      "Lo que opina mi grupo de amigos influye mucho en mis decisiones",
      "Me gusta experimentar cosas nuevas aunque impliquen cierto riesgo",
      "Obedezco reglas solo si alguien me vigila. (invertida)",
      "Sigo normas porque entiendo su utilidad",
      "Prefiero actividades de juego/diversión aunque tenga pendientes",
      "Puedo dejar el ocio para cumplir una responsabilidad. (invertida)",
      "Actúo sin pensar cuando algo me emociona. (invertida)",
      "Evalúo pros y contras antes de tomar decisiones importantes",
      "Mantengo hábitos de autocuidado (sueño, aseo, alimentación)",
      "Necesito que me organicen rutinas básicas (tareas, horarios). (invertida)",
      "Considero cómo afectan mis acciones a otras personas"
    ];

    const itemsDiv = document.getElementById("items");

    // Crear inputs dinámicos
    items.forEach((texto, i) => {
      const div = document.createElement("div");
      div.classList.add("item");

      const label = document.createElement("label");
      label.textContent = (i + 1) + ") " + texto;

      const input = document.createElement("input");
      input.type = "text";
      input.name = "item" + (i + 1);
      input.required = true;

      div.appendChild(label);
      div.appendChild(input);
      itemsDiv.appendChild(div);
    });

    // Manejar submit
    document.getElementById("cuestionario").addEventListener("submit", function(e) {
      e.preventDefault();

      const data = {
        edad: document.querySelector('input[name="edad"]').value,
        sexo: document.querySelector('input[name="sexo"]').value,
        escolaridad: document.querySelector('input[name="escolaridad"]').value,
        ocupacion: document.querySelector('input[name="ocupacion"]').value,
        estatura: document.querySelector('input[name="estatura"]').value,
        peso: document.querySelector('input[name="peso"]').value,
        sueno: document.querySelector('input[name="sueno"]').value,
        actividad: document.querySelector('input[name="actividad"]').value,
      };

      // Agregar respuestas de ítems
      const inputs = document.querySelectorAll("#items input");
      inputs.forEach((input, i) => {
        data["item" + (i + 1)] = input.value.trim();
      });

      fetch('/guardar', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
      .then(res => res.json())
      .then(data => {
        if(data.success) alert("✅ Formulario enviado correctamente");
        else alert("❌ Error al guardar los datos");
      })
      .catch(err => {
        console.error(err);
        alert("❌ Error al enviar la solicitud");
      });
    });
  </script>
</body>
</html>
